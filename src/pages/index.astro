---
export const prerender = true;

import "../styles/global.css";
import { getCollection } from "astro:content";
import { resolveSvg } from "@/lib/resolve-svg";
import Header from "@/components/header";
import HeroSection from "@/components/hero-section";
import PageBackground from "@/components/page-background";
import SectionTitleAnimation from "@/components/section-title-animation";
import ModulesCreatedSection from "@/components/modules-created-section";
import LogoSection from "@/components/logo-section";
import WhatWeCanDoSection from "@/components/carousel-accordion-section/what-we-can-do-section";
import ServicesOverviewSection from "@/components/carousel-accordion-section/services-overview-section";
import WhoCanBenefitSection from "@/components/who-can-benefit-section";
import WhatOurClientSaySection from "@/components/what-our-client-say-section";
import ScrollCurtainSection from "@/components/scroll-curtain-section";
import Footer from "@/components/footer";
import { Toaster } from "@/components/ui/toaster";

const servicesEntries = await getCollection("services");
const services = servicesEntries
  .sort((a, b) => a.data.id - b.data.id)
  .map(entry => ({
    id: entry.data.id,
    title: entry.data.title,
    description: entry.body?.trim() ?? "",
    image: resolveSvg(entry.data.image),
    details: entry.data.details,
  }));

const logosEntries = await getCollection("logos");
const logos = logosEntries
  .sort((a, b) => Number(a.data.id) - Number(b.data.id))
  .map(entry => ({
    id: entry.data.id,
    title: entry.data.title,
    icon: resolveSvg(entry.data.icon),
  }));

const testimonialsEntries = await getCollection("testimonials");
const testimonials = testimonialsEntries
  .sort((a, b) => a.data.id - b.data.id)
  .map(entry => ({
    id: entry.data.id,
    description: entry.body?.trim() ?? "",
    author: entry.data.author,
    department: entry.data.department,
    image: resolveSvg(entry.data.image),
  }));
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Cleverli</title>
  </head>
  <body
    class="flex min-h-screen flex-col items-center overflow-x-hidden bg-linear-to-br from-slate-50 to-slate-100"
  >
    <div class="relative flex w-full flex-col items-center">
      {/* Background and Header Wrapper */}
      <div class="relative w-full">
        <PageBackground client:load />

        <div
          class="relative z-10 flex w-full flex-col items-center gap-8 lg:p-8"
        >
          <Header client:load pathname={Astro.url.pathname} />

          <div class="flex w-full max-w-360 flex-col items-center px-4 lg:px-0">
            <div class="relative flex w-full flex-col gap-14 lg:gap-20">
              <HeroSection client:load />
              <SectionTitleAnimation
                client:load
                text="What We Do Best?"
                className="lg:mt-10"
              />
              <ModulesCreatedSection client:load />
              <LogoSection client:load data={logos} />
              <ServicesOverviewSection client:load data={services} />
              <WhatWeCanDoSection client:load data={services} />
              <WhoCanBenefitSection client:load />
              <WhatOurClientSaySection client:load data={testimonials} />
            </div>
          </div>
          <div class="z-10 w-full max-w-360 px-4 lg:px-0">
            <ScrollCurtainSection client:load />
          </div>
          <Footer client:load />
          <Toaster client:load />
        </div>
      </div>
    </div>
  </body>
</html>
